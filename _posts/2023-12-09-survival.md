---
layout: post
title:  Kaplan-Meier survival estimate
date: 2023-12-07 21:01:00
description: Principal theory and R code for KM survival estimate and comparissons between survival curves
tags: survival
categories: visualization
thumbnail: assets/img/posts/survival/vaxPrimo.jpg
bibliography: survival.bib
toc:
  sidebar: left
  
---


## Introduction
This post presents the basic theory on Survival Analysis and provide R code to produce Kaplan-Meier plots.

```R
# Load required libraries
library(survival)
library(tibble)
library(ggplot2)
library(survminer)

```
### The basics


### Packages

<div class="row mt-4">
    <div class="col-6 col-sm-3 mt-4 mt-md-0">
        {% include figure.html path="assets/img/posts/longit_plots/ggplot2.jpg" class="img-fluid rounded z-depth-1" style="max-width: 100px; max-height: 100px;"  %}
    </div>
    <div class="col-6 col-sm-3 mt-4 mt-md-0">
        {% include figure.html path="assets/img/posts/longit_plots/tibble.jpeg" class="img-fluid rounded z-depth-1" style="max-width: 100px; max-height: 100px;"  %}
    </div>
    
</div>
<div class="caption">
    Libraries for this post.
</div>

```R
library(survival)
library(tibble)
library(ggplot2)
library(survminer)
```

### The dataset

For this post, we'll generate a dataset with five variables: patient ID, time to event (survival time), event indicator (whether the event occurred or not), and a binary treatment variable (0 or 1) to represent whether each patient received a particular treatment.

```R
# Set a seed for reproducibility
set.seed(123)

# Number of observations
n <- 100

# Generate an imaginary ID
id <- 1:n

# Generate a covariate (continuous)
covariate <- rnorm(n)

# Generate a binary treatment variable (0 or 1)
treatment <- rbinom(n, size = 1, prob = 0.5)

# Generate survival time (time to event)
time <- rexp(n, rate = ifelse(treatment == 1, 0.08, 0.1))  # Higher rate for Treatment A

# Create event indicator (1=event occurred, 0=censored)
event <- rbinom(n, size = 1, prob = pexp(time, rate = 0.1))

# Map treatment categories to "Treatment A" and "Placebo"
treatment_category <- factor(ifelse(treatment == 1, "Treatment A", "Placebo"), levels = c("Placebo", "Treatment A"))

# Create a data frame
data <- tibble(
  ID = id,
  Time = pmin(time, 10),  # Truncate survival time at 10 units for illustration
  Event = event,
  Covariate = covariate,
  Treatment = treatment_category
)

# Display the first few rows of the dataset
head(data)

```

## Kaplan-Meier Plots

```R

# Fit Kaplan-Meier survival curve
fit_km <- survfit(Surv(Time, Event) ~ Treatment, data = data)

# Plot Kaplan-Meier curves
g <- ggsurvplot(
  fit_km,
  data = data,
  risk.table = TRUE,
  pval = TRUE,
  conf.int = TRUE,
  ggtheme = theme_minimal(),
  palette = c("#0073C2FF", "#EFC000FF"),  # Blue for Treatment A, Yellow for Placebo
  legend.title = "Treatment",
  legend.labs = c("Treatment A", "Placebo"),
  xlab = "Time",
  ylab = "Survival Probability",
  main = "Kaplan-Meier Survival Curves by Treatment"
)

print(g)

```
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.html path="assets/img/posts/survival/km.jpeg" class="img-fluid rounded z-depth-1" zoomable=true %}
    </div>
  <div class="caption">
    Kaplan-Meier curves for the treatment goup.
</div>

## Comparing Survival Curves between Groups

```R
# Perform log-rank test
logrank_test <- survdiff(Surv(Time, Event) ~ Treatment, data = data)

# Display the log-rank test results
print(logrank_test)
```

