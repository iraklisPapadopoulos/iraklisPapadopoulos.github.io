<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <h2 id="introduction">Introduction</h2> <p>This post presents the basic theory of Survival Analysis and provides R code to generate Kaplan-Meier plots. In the world of statistics and data science, understanding survival functions and estimating probabilities becomes crucial, especially when dealing with censored data.</p> <p>Survival analysis<d-cite key="aalen2008survival"></d-cite> plays a pivotal role in various fields such as medicine, finance, and sociology, providing valuable insights into the time until an event of interest occurs. At the heart of this analysis is the Kaplan-Meier estimator, a powerful tool for estimating the survival function.</p> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Survival Analysis Basics</title> <h1>Survival Analysis Basics</h1> <ol> <li> <strong>Survival Function (S(t)):</strong> The probability that an event has not occurred by time t.</li> <li> <strong>Hazard Function (h(t)):</strong> The instantaneous rate of failure at time t.</li> <li> <strong>Survival Time (T):</strong> The random variable representing the time until the event.</li> <li> <strong>Censoring:</strong> Occurs when event times for some individuals are not observed by the end of the study.</li> <li> <strong>Kaplan-Meier Estimator:</strong> Non-parametric estimator for estimating the survival function.</li> <li> <strong>Log-Rank Test:</strong> Statistical test to compare survival curves of two or more groups.</li> <li> <strong>Cox Proportional-Hazards Model:</strong> Regression model to assess the effect of covariates on the hazard function.</li> <li> <strong>Median Survival Time:</strong> The time point at which 50% of subjects have experienced the event.</li> </ol> <p>The Kaplan-Meier estimator is used to estimate the survival function from censored data. The survival function &lt;p&gt;(S(t))&lt;/p&gt; represents the probability that a subject survives beyond time &lt;p&gt;(t) &lt;/p&gt;. The Kaplan-Meier estimator is defined as follows:</p> <p>Identify all unique event times (times at which events occur) and censoring times. Denote them as \(t_1, t_2, \ldots, t_k\).</p> <p>The survival probability at the first event time (\(t_1\)) is calculated as:</p> <p>\[ \hat{S}(t_1) = 1 \]</p> <p>Since there are no events before \(t_1\), the probability of surviving beyond \(t_1\) is 1.</p> <p>For each subsequent event time \(t_i\), where \(i &gt; 1\), the survival probability is calculated using the formula:</p> <p>\[ \hat{S}(t_i) = \hat{S}(t_{i-1}) \times \left(1 - \frac{d_i}{n_i}\right) \]</p> <p>where:</p> <ul> <li>\(d_i\) is the number of events at time \(t_i\).</li> <li>\(n_i\) is the number of subjects at risk just before time \(t_i\).</li> </ul> <p>If there are censored observations at any time point \(t_i\), adjust the probability as follows:</p> <p>\[ \hat{S}(t_i) = \hat{S}(t_{i-1}) \times \left(1 - \frac{d_i}{n_i}\right)^{1 - c_i} \]</p> <p>where \(c_i\) is the number of censored observations at time \(t_i\).</p> <p>The final survival probability at the last event time (\(t_k\)) is the product of all the individual survival probabilities:</p> <p>\[ \hat{S}(t_k) = \hat{S}(t_{k-1}) \times \left(1 - \frac{d_k}{n_k}\right)^{1 - c_k} \]</p> <h3 id="packages">Packages</h3> <div class="row mt-4"> <div class="col-6 col-sm-3 mt-4 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/posts/survival/ggplot2-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/posts/survival/ggplot2-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/posts/survival/ggplot2-1400.webp"></source> <img src="/assets/img/posts/survival/ggplot2.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-6 col-sm-3 mt-4 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/posts/survival/tibble.jfif-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/posts/survival/tibble.jfif-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/posts/survival/tibble.jfif-1400.webp"></source> <img src="/assets/img/posts/survival/tibble.jfif" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Libraries for this post. </div> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Load required libraries</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">survival</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tibble</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">survminer</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <h3 id="the-dataset">The dataset</h3> <p>For this post, weâ€™ll generate a dataset with five variables: patient ID, time to event (survival time), event indicator (whether the event occurred or not), and a binary treatment variable (0 or 1) to represent whether each patient received a particular treatment.</p> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Set a seed for reproducibility</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span><span class="w">

</span><span class="c1"># Number of observations</span><span class="w">
</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">100</span><span class="w">

</span><span class="c1"># Generate an imaginary ID</span><span class="w">
</span><span class="n">id</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="w">

</span><span class="c1"># Generate a covariate (continuous)</span><span class="w">
</span><span class="n">covariate</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w">

</span><span class="c1"># Generate a binary treatment variable (0 or 1)</span><span class="w">
</span><span class="n">treatment</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbinom</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w">

</span><span class="c1"># Generate survival time (time to event)</span><span class="w">
</span><span class="n">time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rexp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">rate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">treatment</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0.08</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">))</span><span class="w">  </span><span class="c1"># Higher rate for Treatment A</span><span class="w">

</span><span class="c1"># Create event indicator (1=event occurred, 0=censored)</span><span class="w">
</span><span class="n">event</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbinom</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pexp</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">rate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">))</span><span class="w">

</span><span class="c1"># Map treatment categories to "Treatment A" and "Placebo"</span><span class="w">
</span><span class="n">treatment_category</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">ifelse</span><span class="p">(</span><span class="n">treatment</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="s2">"Treatment A"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Placebo"</span><span class="p">),</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Placebo"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Treatment A"</span><span class="p">))</span><span class="w">

</span><span class="c1"># Create a data frame</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tibble</span><span class="p">(</span><span class="w">
  </span><span class="n">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w">
  </span><span class="n">Time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pmin</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">),</span><span class="w">  </span><span class="c1"># Truncate survival time at 10 units for illustration</span><span class="w">
  </span><span class="n">Event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">,</span><span class="w">
  </span><span class="n">Covariate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">covariate</span><span class="p">,</span><span class="w">
  </span><span class="n">Treatment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">treatment_category</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c1"># Display the first few rows of the dataset</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w">

</span></code></pre></div></div> <h2 id="kaplan-meier-plots">Kaplan-Meier Plots</h2> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Survival Analysis Basics and KM Plot Interpretation</title> <h1>Kaplan-Meier Plot Interpretation</h1> <p>A Kaplan-Meier (KM) plot is a graphical representation of the survival function estimated from time-to-event data. It is particularly useful in scenarios where you have censored data and want to visualize the probability of an event (such as death, relapse, or failure) occurring over time.</p> <p><strong>X-Axis (Time):</strong> The horizontal axis represents time, typically in units like days, months, or years, depending on the study design. It shows the duration of the study or observation period.</p> <p><strong>Y-Axis (Survival Probability):</strong> The vertical axis represents the estimated survival probability. At the beginning of the study, the survival probability is 1.0 (100%), indicating that all subjects are alive or have not experienced the event of interest.</p> <p><strong>Steps or Drops:</strong> The plot consists of a series of steps or drops. Each step represents an event (e.g., death) occurring in the study. The height of the step corresponds to the proportion of subjects surviving at that time point.</p> <p><strong>Tick Marks:</strong> Tick marks on the X-axis indicate censored observations, meaning the event did not occur for those subjects during the study period. Censoring is common in survival analysis when subjects are lost to follow-up or the study ends before an event occurs.</p> <p><strong>Curves for Different Groups:</strong> If you're comparing multiple groups, there will be separate curves for each group on the same plot. Differences in the curves can visually indicate whether there are significant disparities in survival times between the groups.</p> <p><strong>Median Survival Time:</strong> The point on the X-axis where the survival curves cross 0.5 (50% survival probability) represents the median survival time. This is the time at which 50% of the subjects have experienced the event of interest.</p> <p><strong>Interpretation:</strong> As you move along the X-axis, the survival probability decreases, reflecting the increasing likelihood of the event occurring. The steeper the drop in the curve, the faster events are happening in that time period. Differences in curves between groups can suggest different survival experiences.</p> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="c1"># Fit Kaplan-Meier survival curve</span><span class="w">
</span><span class="n">fit_km</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">survfit</span><span class="p">(</span><span class="n">Surv</span><span class="p">(</span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">Event</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Treatment</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w">

</span><span class="c1"># Plot Kaplan-Meier curves</span><span class="w">
</span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggsurvplot</span><span class="p">(</span><span class="w">
  </span><span class="n">fit_km</span><span class="p">,</span><span class="w">
  </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w">
  </span><span class="n">risk.table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
  </span><span class="n">pval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
  </span><span class="n">conf.int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
  </span><span class="n">ggtheme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theme_minimal</span><span class="p">(),</span><span class="w">
  </span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"#0073C2FF"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#EFC000FF"</span><span class="p">),</span><span class="w">  </span><span class="c1"># Blue for Treatment A, Yellow for Placebo</span><span class="w">
  </span><span class="n">legend.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Treatment"</span><span class="p">,</span><span class="w">
  </span><span class="n">legend.labs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Treatment A"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Placebo"</span><span class="p">),</span><span class="w">
  </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Time"</span><span class="p">,</span><span class="w">
  </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Survival Probability"</span><span class="p">,</span><span class="w">
  </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Kaplan-Meier Survival Curves by Treatment"</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="w">

</span></code></pre></div></div> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/posts/survival/km-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/posts/survival/km-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/posts/survival/km-1400.webp"></source> <img src="/assets/img/posts/survival/km.jpeg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Anti-Spike IgG through time by booster vaccination vaccine. </div> <h2 id="comparing-survival-curves-between-groups">Comparing Survival Curves between Groups</h2> <p>The log-rank test is a statistical method used to compare the survival distributions of two or more groups in a study. It is commonly employed in survival analysis, where the primary outcome is time until a particular event of interest occurs (e.g., death, relapse, failure).</p> <p>The log-rank test assesses whether there are any significant differences in the survival experiences of different groups over time. It does so by comparing the observed number of events (e.g., deaths) in each group with the number of events that would be expected if the null hypothesis were true, assuming no difference between the groups.</p> <p>The null hypothesis for the log-rank test is that there is no difference in the survival distributions of the compared groups. If the test yields a p-value below a predetermined significance level (commonly 0.05), it indicates that there is evidence to reject the null hypothesis, suggesting that there are significant differences in survival experiences between the groups.</p> <p>The log-rank test is a non-parametric test, meaning that it makes no assumptions about the shape of the survival distributions. It is widely used in clinical trials, epidemiology, and other fields where researchers are interested in comparing the time-to-event outcomes between different groups.</p> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Perform log-rank test</span><span class="w">
</span><span class="n">logrank_test</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">survdiff</span><span class="p">(</span><span class="n">Surv</span><span class="p">(</span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">Event</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Treatment</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w">

</span><span class="c1"># Display the log-rank test results</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">logrank_test</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Call:
survdiff(formula = Surv(Time, Event) ~ Treatment, data = data)<span class="sb">

                       N Observed Expected (O-E)^2/E (O-E)^2/V
</span>Treatment=Placebo     52       24     24.1  0.000667   0.00253
Treatment=Treatment A 48       28     27.9  0.000578   0.00253

 Chisq= 0  on 1 degrees of freedom, p= 1 
</code></pre></div></div> </body></html>